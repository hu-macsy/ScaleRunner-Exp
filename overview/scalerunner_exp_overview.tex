\documentclass[11pt, a4paper]{scrartcl}

\usepackage[T1]{fontenc}
\usepackage{url}
\usepackage{hyperref}
\usepackage{listings}
\usepackage{xspace}

\newcommand{\expfile}{\texttt{experiments.yml} file\xspace}

\begin{document}

\lstset{  
  tabsize=2, 
  showspaces=false, 
  showstringspaces=false, 
%   backgroundcolor=\color{listgray}, 
  float=[htb], 
  captionpos=b, 
  basicstyle=\footnotesize, 
  frame=tbrl, %t: top, r, b, l 
  frameround=tttt, 
  numbers=left, 
  numberstyle=\tiny, 
  numberblanklines=false, 
  breaklines=true
} 

\title{\small{ScaleRunner: A Fast MPI-based \\ Random Walk Engine for Multi-CPU Systems} \\ \LARGE{Artifact Overview}}

\author{Florian Willich, Henning Meyerhenke \\ Humboldt-Universit\"at zu Berlin, Germany}

\maketitle

\section{Introduction}

In this overview document we describe all necessary steps to setup, configure,
compile, link and run all defined experiments as well as to evaluate the results
presented in the paper \textit{ScaleRunner: A Fast MPI-based Random Walk Engine
for Multi-CPU Systems}. This document should serve everyone interested to
reproduce our experiments, however we specifically address the EuroPar'25
artifact evaluation committee for our artifact submission.

Please consider that we conducted our experiments on a cluster with 16 compute
nodes, each equipped with 2$\times$ 12-Core Intel Xeon X6126 (HT) CPUs, and 192
GB RAM inter-connected by a 100 GBit Infiniband Omnipath network. C++ code was
compiled using GCC v12.3 with MPICH v4.2.0.

Running all experiments with the original graph files can take more than 24
hours. Therefore, we provide a small example graph data set which we will use to
showcase all conducted experiments, as well as plotting the measurements.

The whole experiment setup uses
Simexpal~\footnote{\url{https://github.com/hu-macsy/simexpal}} which is well
documented~\footnote{\url{https://simexpal.readthedocs.io/en/latest/}} which we
recommend to read in case you experience any issues we have not covered in this
document.

We will provide all necessary steps to run experiments and evaluate
results in Sec.~\ref{sec:getting_started}.

\section{Getting Started}\label{sec:getting_started}

\subsection{Software Requirements}

The following software was used to conduct and evaluate our experiments:

\begin{itemize}
    \item SimexPal (commit c848baba0baa8e9794bdcc6b9c5d2a507a840953)
    \item C++ Compiler GCC (v12.3) with (minimum) support of C++17
    \item OpenMP (v4.5)
    \item MPICH (v4.2.0)
    \item Python3 (v3.12.3)
    \item Python Jupyter Notebook~\footnote{\url{https://jupyter.org/install}}
\end{itemize}

To install python packages you may want to activate your python virtual
environment. We provide a \expfile including all modules
needed to run our evaluation script.

To install the right version of SimexPal you can use pip:

\begin{lstlisting}[language=bash]
pip install git+https://github.com/hu-macsy/simexpal.git@c848baba0baa8e9794bdcc6b9c5d2a507a840953
\end{lstlisting}

Or you install SimexPal by cloning the repository:

\begin{lstlisting}[language=bash]
git clone https://github.com/hu-macsy/simexpal.git
cd simexpal
git checkout c848baba0baa8e9794bdcc6b9c5d2a507a840953
pip install -e .
\end{lstlisting}

Please install the same SimexPal version (commit) to later evaluate the results
using Jupyter Notebook. If you use a special python kernel for all the required
python packages, remember to run the Jupyter Notebook using the same python
kernel. Also, consider reading the quick start
guide~\footnote{\url{https://simexpal.readthedocs.io/en/latest/quick_start.html}}
for SimexPal if you have issues with the installation or the usage of the tool.

\subsection{Build all Targets}

The \texttt{experiments.yml} file defines all builds, experiments and their
parameters, graph instances to run our experiments. First, we will need to
configure, compile and link all builds defined in the \expfile. Please navigate
to the root directory of the project where the \texttt{experiments.yml} is
located, then execute:

\begin{lstlisting}[language=bash]
simex develop
\end{lstlisting}

With this command, you may encounter two issues:

\begin{enumerate}
    \item Your C++ compiler does not support certain functionalities needed by
    our programs. To fix this, you can export the required C++ compiler. For
    example, for the GNU v12 C++ compiler \textit{G++12} use: \texttt{export
    CXX=/usr/bin/g++-12}. In case you have already tried to build using
    \texttt{simex develop}: reconfigure using \texttt{simex develop
    --reconfigure} instead.
    \item The \texttt{scalerunnerConfig.cmake} file cannot be found since you
       did not provide the \texttt{scalerunner\_DIR} to the build \texttt{io\_benchmark}.
       
       Please navigate into the \texttt{experiments.yml} file under the build
       \texttt{io\_benchmark}. There you will find the configure steps for the build.
       The \texttt{scalerunner\_DIR} is either provided using \texttt{/lib/...} or
       \texttt{/lib64/...}. Please comment in/out one of the lines depending on the
       requirements of your system. This may also be the case for build
       \texttt{sr\_benchmark}. Reconfigure using \texttt{simex develop --reconfigure} instead.
\end{enumerate}

\subsection{Convert Graph Instance Files}

Next, we need to convert the \textit{graph instance files} located under
directory \texttt{/instances} using the python convert script named
\texttt{convert.py}. Either call the convert script as described in the \expfile
under key \texttt{instances} or use SimexPal:

\begin{lstlisting}[language=bash]
simex instances install
\end{lstlisting}

\subsection{Launch Experiments}\label{sec:getting_started:launch_experiments}

Finally, we can run all experiments! In this case we are using the option
\texttt{--launch-through=fork} to run one experiment after the other in the same
process as the one calling simex: 

\begin{lstlisting}[language=bash]
simex e launch --launch-through=fork
\end{lstlisting}

MPI clusters often require different runtimes to execute MPI programs. If you
need (or want) to change the runtime that executes the programs using MPI,
namely the programs \texttt{kk\_benchmark}, \texttt{sr\_benchmark}, and
\texttt{io\_benchmark} you will have to adapt the \expfile under the key
\texttt{experiments}, where you find the arguments passed to call the program.
There are also instructions to adapt the arguments to your systems requirements. 

After launching all experiments, you can list all experiments and their status
using:

\begin{lstlisting}[language=bash]
simex e list
\end{lstlisting}

Which should now look similar to:

\begin{lstlisting}[language=bash]
Experiment                     started    finished   failures      other
----------                     -------    --------   --------      -----
graphanalysis @ _dev                      4/4                             
graphfile-input ~ gdsb-mpi-io             4/4                             
graphfile-input ~ original @ _            4/4                             
kk-crw ~ 80 @ _dev                        4/4                             
kk-node2vec ~ 80, homopholy @             4/4                             
kk-node2vec ~ 80, structure @             4/4                             
scalerunner-crw ~ 80 @ _dev               4/4                             
scalerunner-node2vec ~ 80, hom            4/4                             
scalerunner-node2vec ~ 80, str            4/4                             
scalerunner-scaling1 ~ 80 @ _d            4/4                             
scalerunner-scaling16 ~ 80 @ _            4/4                             
scalerunner-scaling2 ~ 80 @ _d            4/4                             
scalerunner-scaling4 ~ 80 @ _d            4/4                             
scalerunner-scaling8 ~ 80 @ _d            4/4                             
56 experiments in total
\end{lstlisting}

The output tells us that for all defined experiments we have run 4 experiments
and all 4 finished (successfully).

If there have been any failed runs and you would like to re-run them you can
purge all experiments:

\begin{lstlisting}[language=bash]
simex e purge --all -f
\end{lstlisting}

All output files have been written to the output folder: \texttt{/output}.

\subsection{Evaluate Results}

If you ran the experiments on another machine and you would like to archive and
copy the results to another, first archive the data:

\begin{lstlisting}[language=bash]
simex archive
\end{lstlisting}

This will compress the output folder and the \expfile and write the file
\texttt{data.tar.gz}. Copy this file to the machine you want to evaluate the
results on, and extract the contents to the top level such that the directory
\texttt{output} is on the same level as the \texttt{evaluation.ipynb} file.
Doing so will overwrite the already present \expfile.

We can now evaluate our experiments using the evaluation jupyter notebook
script: \texttt{evaluation.ipynb}. Remember: this requires you to have installed
a \emph{Jupyter Notebook
Environment}~\footnote{\url{https://jupyter.org/install}}.

First, the notebook defines all imports, and therefore all python 3 packages you
will need to install. As described above, all required python 3 packages are
defined in \texttt{requirements.txt}. Now, run all cells of the notebook. You
will not need to change anything of the script. If you do not want to write all
plots to a PDF file, change the global variable \texttt{save\_all\_plots=True} to
\texttt{save\_all\_plots=False}.

Please note that the plotted results are not to be interpreted in any way, our
example data set is just enough to provide a running example with very small
graph instances.

\section{Step-by-Step Instructions}

In order to reproduce our experiments, the workflow is \emph{nearly} the same as
described in the getting started.

\subsection{Download all Instances}

First, download all instances defined under the key \texttt{instances} in the
\expfile either directly into the instance directory \texttt{/instances} or
any other folder. Do not forget however to create symbolic links to the
files (without the file ending such as `.edges` or `.mtx`). The files must
be named exactly as they are named in the instance definition in the
\expfile.

You may use the following wget commands to download all required instances:

\begin{lstlisting}[language=bash]
wget https://snap.stanford.edu/data/web-NotreDame.txt.gz
wget https://nrvis.com/download/data/rt/rt-retweet-crawl.zip
wget http://nrvis.com/download/data/misc/europe_osm.zip
wget https://snap.stanford.edu/data/amazon0601.txt.gz
wget https://snap.stanford.edu/data/web-Google.txt.gz
wget https://snap.stanford.edu/data/roadNet-CA.txt.gz
wget http://nrvis.com/download/data/misc/human_gene2.zip
wget http://nrvis.com/download/data/misc/cage14.zip
wget https://nrvis.com/download/data/dynamic/rec-amazon-ratings.zip
wget https://nrvis.com/download/data/dynamic/rec-epinions-user-ratings.zip
wget https://nrvis.com/download/data/inf/inf-road-usa.zip
wget https://nrvis.com/download/data/bn/bn-human-Jung2015_M87125334.zip
wget https://snap.stanford.edu/data/soc-LiveJournal1.txt.gz
wget https://nrvis.com/download/data/soc/soc-orkut.zip
wget https://networkrepository.com/bn-human-Jung2015-M87126525.php
wget https://networkrepository.com/web-uk-2005-all.php
wget https://nrvis.com/download/data/soc/soc-twitter-mpi-sws.zip
\end{lstlisting}

Unpack all files, and then either move the graph instance files into the
\texttt{instance} folder or create symbolic links. Again, please make sure to
name all instances the same as defined in the \expfile.

You can also choose to run the experiments using only certain instance sets
which then have to be specified under the key \texttt{matrix} in the \expfile
where each experiment is provided a list of instance sets under the key
\texttt{instsets}. You will find the original \texttt{instsets} list there as
well which we will now need to comment in, and comment out the
\texttt{example\_graphs} instance set.

Once you downloaded and converted all files defined in `instsets`, the list of
instances should mark all instances in green when using:

\begin{lstlisting}[language=bash]
simex e list
\end{lstlisting}

\subsection{Launching Experiments}

Before we can start launching all experiments please make sure to have a look at
the entries under the key \texttt{experiments} in the \expfile. Here, we
currently execute the programs using \texttt{mpirun -n 1} for example. Also the
\texttt{num\_nodes} are set to $1$. As described in the \expfile you will have to
set these parameters to run the experiments using $16$ MPI processes (or less).
Also, the scaling experiments defined under the key \texttt{matrix} are
currently commented out. As described, please comment them in again to reproduce
our experiments.

To run all experiments using the \emph{slurm queue} (also known as partition)
\emph{core}:

\begin{lstlisting}[language=bash]
simex e launch --launch-through=slurm --queue=core
\end{lstlisting}

Otherwise use the forked option as described in
Sec.~\ref{sec:getting_started:launch_experiments}.

Once all experiments are finished, you can \emph{archive} and copy the results
as described above.

\subsection{Evaluate Your Results}

Finally you can evaluate the results using the evaluation jupyter notebook
script:

\texttt{evaluation.ipynb}.

\subsection{Evaluate Our Results}

We provide the original experimental results data set in:

\texttt{/archives/experimental\_results-EUROPAR25.zip}

\noindent which was used to plot the data of our paper. In order to plot the results:
unzip the file into the root directory of this project. Doing so will write an
\texttt{output} directory and an \texttt{experiments.yml} file. The
\texttt{experiments.yml} file represents the original \texttt{experiments.yml}
file used to run and evaluate our experiments. For examples and further
documentation we have made small changes to the \expfile provided in this
artifact, so simply rename the current \expfile to \texttt{experiments.yml.tmp}.
The following commands will do all these steps:

\begin{lstlisting}[language=bash]
rm -rf output
mv experiments.yml experiments.yml.tmp
unzip archives/experimental_resutls-EUROPAR25.zip
mv experimental_resutls-EUROPAR25/* .
\end{lstlisting}

Now you can run the evaluation script which will plot the same figures as we
have in our paper.

\end{document}